<%
  def ostruct_to_hash(os)
    os.marshal_dump.map do |key, value|
      { key => value.is_a?(OpenStruct) ? ostruct_to_hash(value) : value }
    end.reduce(&:merge)
  end

  broker_name = link("broker").p('name')
  log_path = "/var/vcap/sys/log/service-fabrik-backup-manager/service-fabrik-backup-manager.log"
  external = link("broker").p('external')
  internal = link("broker").p('internal')
%>---
production:
  ####################
  # GENERAL SETTINGS #
  ####################
  skip_ssl_validation: <%= link("broker").p('skip_ssl_validation') %>
  log_path: <%= log_path %>
  log_level: <%= link("broker").p('log_level') %>
  enable_circuit_breaker: <%= link("broker").p('enable_circuit_breaker') %>

  ###################
  # BACKUP SETTINGS #
  ###################
  backup:
    retention_period_in_days: <%= link("broker").p('backup.retention_period_in_days') %>
    max_num_on_demand_backup: <%= link("broker").p('backup.max_num_on_demand_backup') %>
    status_check_every: <%= link("broker").p('backup.status_check_every') %>
    retry_delay_on_error: <%= link("broker").p('backup.retry_delay_on_error') %>
    lock_check_delay_on_restart: <%= link("broker").p('backup.lock_check_delay_on_restart') %>
    backup_restore_status_poller_timeout: <%= link("broker").p('backup.backup_restore_status_poller_timeout') %>
    backup_restore_status_check_every: <%= link("broker").p('backup.backup_restore_status_check_every') %>
    abort_time_out: <%= link("broker").p('backup.abort_time_out') %>
    consecutive_backup_failure_sla_count: <%= link("broker").p('backup.consecutive_backup_failure_sla_count') %>
    provider: <%= JSON.dump(link("broker").p('backup.provider', nil)) %>

  #################################
  # VIRTUAL HOST MANAGER SETTINGS #
  #################################
  virtual_host:
    provider: <%= JSON.dump(link("broker").p('virtual_host.provider', nil)) %>

  etcd:
    url: <%= link("broker").p('etcd.url') %>
    ssl: <%= JSON.dump(link("broker").p('etcd.ssl')) %>

  #####################
  # DIRECTOR SETTINGS #
  #####################
  directors: <%= JSON.dump(link("broker").p('directors')) %>
  ####################
  # SERVICES CATALOG #
  ####################
  services: <%= JSON.pretty_generate(link("broker").p('services')) %>
